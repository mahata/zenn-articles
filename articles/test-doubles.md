---
title: "テストダブルとは何か?"
emoji: "5️⃣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["testdoubles", "testing", "tdd", "kotlin"]
published: false
---

テストダブルという言葉をご存知でしょうか? 仮に知らないとしても、多くのソフトウェアエンジニアはこれを利用したことがあります。たとえば Java の世界で Mockito を使ったり、JavaScript の世界で Jest を使う場合、ほぼ間違いなくテストダブルを使っています。

テストダブルには、いくつか種類があります。よく名前が知られているのは「モック」です。テストコードについて会話するとき「関数をモックする」という表現をしたことはありませんか? 多くの場合、口語では「本物の関数とは異なる振る舞いをさせる」ことを「モックする」と 言います。しかし、それは本当に「モック」しているのでしょうか? そもそも「モック」の定義は何でしょうか? この記事では、そのような疑問に答えていこうと思います。

(執筆中: スタントダブルの話)

## テストダブルの種類

テストダブルにはいくつか種類があります。分類の仕方にはいくつかありますが、[Martin Fowler 氏に倣い](https://martinfowler.com/articles/mocksArentStubs.html)、この記事では次の 5 種類に分類します。

* **ダミー:** コンパイルを通すために取りあえず作られるテストダブル (実際に使おうとすると壊れる)。
* **フェイク:** 実際に動作させられる偽物。通常は何かの欠陥があり、本番環境には適さない (たとえばインメモリデータベース)。
* **スタブ:** コールすると、あらかじめ決められた値を返すテストダブル。
* **スパイ:** どのように呼び出されたかを記録するテストダブル。
* **モック:** 自分自身をアサートできるスパイ。

いかがでしょうか? きっと「わけがわからない」と思った方も多いでしょう。筆者自身、不慣れなときにこの説明だけを読んだら「はぁ?」となったと思います。ぜひ細かいことは気にせず、最後まで記事を読み通していただけると幸いです。読み通した後でここに戻っていただければ「なるほど...」となるはずです。

### テストダブルを分類するモチベーション

「プロとして」

(執筆中)

## 「ロケット発射」システムをテストするテストダブル

ここからはハンズオンです。「ロケット発射」を制御するプログラムを例に、テストダブルについて考えましょう。例は Kotlin ですが、Kotlin の知識がなくても理解できるように書いています。具体的には「インタフェース」と「継承」の概念がわかれば読み進められるでしょう。

:::message
このプログラムにはネタ元が存在します。VMware Tanzu Labs が公開していた「The Test Double Rule of Thumb」というブログ記事です。2024 年の中頃まではアクセスできたのですが、ブログそのものが非公開になってしまいました。

ネタ元の記事は元々 Java で書かれており、ロケットではなくミサイルの発射を制御するような内容でした。アクセスはできなくなってしまったものの、筆者は元記事に多大なリスペクトを払っています。
:::

(執筆中)
